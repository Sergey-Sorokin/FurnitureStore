@using FurnitureStore.Areas.Administration.ViewModels;
@model PaginaionViewModel

@{
    ViewBag.Title = "Мебель";
}

<h2>Предложения</h2>

<section class="content_i">
    @{
        Html.RenderPartial("_Index", Model);
    }
</section>

@if (Model.HasMoreItems) {
    @section Scripts {
        <script type="text/javascript">
            (function () {
                $(function () {
                    return $(document).on('click', '[data-behavior=load-next-page]', function (e) {
                        var $next_btn, next_page, url;
                        e.preventDefault();
                        $next_btn = $(this);
                        url = $next_btn.data('url');
                        next_page = $next_btn.data('next-page');
                        if ($next_btn.hasClass("disabled")) {
                            return;
                        }
                        $next_btn.addClass("disabled").data("old-title", $next_btn.text()).text("Загружаю предложения...");
                        return $.ajax(url, {
                            type: 'GET',
                            dataType: 'html',
                            data: {
                                page: next_page
                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                return alert('Ой! На сервере, что-то случилось! :`-(');
                            },
                            success: function (data, textStatus, jqXHR) {
                                var $new;
                                $new = $(data);
                                $new.insertAfter($('.products-list:last'));
                                //$new.find(".styler").styler();
                                //$new.filter(".content_i").appendTo($(document).find(".content"));
                                return $next_btn.closest(".load-more").remove();
                            },
                            error: function () {
                                return $next_btn.removeClass("disabled").text($next_btn.data("old-title"));
                            }
                        });
                    });
                });

            }).call(this);
        </script>
    }
}